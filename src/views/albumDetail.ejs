<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/detail.css">
    <script src="/js/colorExtractor.js" defer></script>
</head>
<body>
    <%- include("partials/nav.ejs") %>
    <div class="detail-container">
        <h1><%= album.title || "Unknown Album" %></h1>
        
        <% if (coverArtUrl) { %>
        <div class="album-artwork">
            <img src="<%= coverArtUrl %>" alt="<%= album.title || 'Album' %> cover art">
        </div>
        <% } %>
        
        <div class="detail-section">
            <h2>Album Information</h2>
            <% if (album["primary-type"] || album["secondary-types"]) { %>
                <p><strong>Type:</strong> 
                    <% if (album["primary-type"]) { %>
                        <%= album["primary-type"] %>
                    <% } %>
                    <% if (album["secondary-types"] && album["secondary-types"].length > 0) { %>
                        (<%= album["secondary-types"].join(", ") %>)
                    <% } %>
                </p>
            <% } %>
            <p><strong>Artist:</strong> 
                <% if (album["artist-credit"] && album["artist-credit"].length > 0) { %>
                    <% album["artist-credit"].forEach((ac, idx) => { %>
                        <% if (ac.artist && ac.artist.id) { %>
                            <a href="/artists/<%= ac.artist.id %>"><%= ac.name %></a><%= idx < album["artist-credit"].length - 1 ? ", " : "" %>
                        <% } else { %>
                            <%= ac.name %><%= idx < album["artist-credit"].length - 1 ? ", " : "" %>
                        <% } %>
                    <% }); %>
                <% } else { %>
                    N/A
                <% } %>
            </p>
            <p><strong>Release Date:</strong> <%= album.date || "N/A" %></p>
            <p><strong>Status:</strong> <%= album.status || "N/A" %></p>
            <p><strong>Country:</strong> <%= album.country || "N/A" %></p>
        </div>

        <% if (album.media && album.media.length > 0) { %>
        <div class="detail-section">
            <h2>Track Listing</h2>
            <% album.media.forEach((disc, index) => { %>
                <h3>Disc <%= index + 1 %> (<%= disc.format || "Unknown Format" %>)</h3>
                <% if (disc.tracks && disc.tracks.length > 0) { %>
                    <ol>
                    <% disc.tracks.forEach(track => { %>
                        <li>
                            <% if (track.recording && track.recording.id) { %>
                                <a href="/songs/<%= track.recording.id %>"><%= track.title || (track.recording ? track.recording.title : "Unknown") %></a>
                            <% } else { %>
                                <%= track.title || (track.recording ? track.recording.title : "Unknown") %>
                            <% } %>
                            <% if (track.length) { %>
                                - <%= Math.floor(track.length / 60000) %>:<%= String(Math.floor((track.length % 60000) / 1000)).padStart(2, "0") %>
                            <% } %>
                        </li>
                    <% }); %>
                    </ol>
                <% } %>
            <% }); %>
        </div>
        <% } %>

        <% if (otherReleases && otherReleases.length > 1) { %>
        <div class="detail-section">
            <h2>All Releases/Editions</h2>
            <p><em>This album has <%= otherReleases.length %> different releases:</em></p>
            <ul class="releases-list">
            <% otherReleases.forEach(release => { %>
                <li>
                    <a href="/albums/<%= release.id %>" <% if (release.id === album.id) { %>style="font-weight: bold;"<% } %>>
                        <%= release.title %>
                    </a>
                    <% if (release.country || release.date) { %>
                        - 
                        <% if (release.country) { %>
                            <%= release.country %>
                        <% } %>
                        <% if (release.date) { %>
                            <%= release.country ? ", " : "" %><%= release.date %>
                        <% } %>
                    <% } %>
                    <% if (release.id === album.id) { %>
                        <strong>(Current)</strong>
                    <% } %>
                </li>
            <% }); %>
            </ul>
        </div>
        <% } %>

        <a href="/albums/search" class="back-link">‚Üê Back to Search</a>
    </div>
</body>
</html>
